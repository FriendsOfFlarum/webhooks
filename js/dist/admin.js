module.exports=function(e){var t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=14)}([function(e,t){e.exports=flarum.core.compat.Model},function(e,t){e.exports=flarum.core.compat["components/Button"]},function(e,t){e.exports=flarum.core.compat["components/Select"]},function(e,t){e.exports=flarum.core.compat.app},function(e,t){e.exports=flarum.core.compat["components/Alert"]},function(e,t){e.exports=flarum.core.compat["models/Forum"]},function(e,t){e.exports=flarum.core.compat["utils/mixin"]},function(e,t){e.exports=flarum.core.compat.extend},function(e,t){e.exports=flarum.core.compat["components/AdminNav"]},function(e,t){e.exports=flarum.core.compat["components/AdminLinkButton"]},function(e,t){e.exports=flarum.core.compat["components/Page"]},function(e,t){e.exports=flarum.core.compat.Component},function(e,t){e.exports=flarum.core.compat["components/Modal"]},function(e,t){e.exports=flarum.core.compat["components/Switch"]},function(e,t,o){"use strict";o.r(t);var n=o(3),r=o.n(n),a=o(0),s=o.n(a),i=o(5),u=o.n(i);function c(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var p=o(6),l=function(e){function t(){return e.apply(this,arguments)||this}return c(t,e),t}(o.n(p)()(s.a,{id:s.a.attribute("id"),service:s.a.attribute("service"),url:s.a.attribute("url"),error:s.a.attribute("error"),events:s.a.attribute("events",function(e){return function(t){return t?JSON.parse(t):e}}([]))})),h=o(7),f=o(8),d=o.n(f),b=o(9),k=o.n(b),v=o(1),w=o.n(v),g=o(10),y=o.n(g),W=o(2),x=o.n(W),N=o(11),O=o.n(N),_=o(4),P=o.n(_),j=o(12),M=o.n(j),S=o(13),C=o.n(S),B=function(e){function t(){return e.apply(this,arguments)||this}c(t,e);var o=t.prototype;return o.init=function(){e.prototype.init.call(this),this.webhook=this.props.webhook;var t=app.forum.attribute("reflar-webhooks.events");this.events=t.reduce(function(e,t){var o=/((?:[a-z]+\\?)+?)\\Event\\([a-z]+)/i.exec(t);if(!o)return e.Other.push({full:t,name:t}),e.Other=e.Other.sort(),e;var n=o[1];return e[n]||(e[n]=[]),e[n].push({full:t,name:o[2]}),e[n]=e[n].sort(),e},{Other:[]})},o.className=function(){return"Modal--medium"},o.title=function(){return app.translator.trans("reflar-webhooks.admin.settings.modal.title")},o.content=function(){var e=this;return m("div",{className:"ReflarWebhooksModal Modal-body"},app.translator.trans("reflar-webhooks.admin.settings.modal.description"),m("div",{className:"Webhook-events"},Object.entries(this.events).sort(function(e){return function(t,o){var n=t[e].toUpperCase(),r=o[e].toUpperCase();return n<r?-1:n>r?1:0}}(0)).map(function(t){var o=t[0],n=t[1];return n.length?m("div",null,m("h3",null,o),n.map(function(t){return C.a.component({state:e.webhook.events().includes(t.full),children:t.name,onchange:e.onchange.bind(e,t.full)})})):null})))},o.onchange=function(e,t,o){o.loading=!0;var n=this.webhook.events();return t?n.push(e):n.splice(n.indexOf(e),1),this.props.updateWebhook(n).then(function(){o.loading=!1,m.lazyRedraw()})},t}(M.a),z=function(e){function t(){return e.apply(this,arguments)||this}return c(t,e),t.prototype.view=function(){var e=this.props,t=e.webhook,o=e.services,n=e.onChange,r=e.onDelete,a=t.service(),s=t.error&&t.error();return o[a]||(s=app.translator.trans("reflar-webhooks.admin.errors.service_not_found",{service:a})),m("div",{className:"Webhooks--row"},m("div",{className:"Webhook-input"},x.a.component({options:o,value:a,onchange:function(e){return n(t,"service",e)}}),m("input",{className:"FormControl Webhook-url",type:"url",value:t.url(),placeholder:app.translator.trans("reflar-webhooks.admin.settings.help.url"),onchange:m.withAttr("value",function(e){return n(t,"url",e)})}),w.a.component({type:"button",className:"Button Webhook-button",icon:"fas fa-edit",onclick:function(){return app.modal.show(new B({webhook:t,updateWebhook:function(e){return n(t,"events",e)}}))}}),w.a.component({type:"button",className:"Button Button--warning Webhook-button",icon:"fas fa-times",onclick:function(){return r(t)}})),!t.events().length&&P.a.component({className:"Webhook-error",children:app.translator.trans("reflar-webhooks.admin.settings.help.disabled"),dismissible:!1}),s&&P.a.component({children:app.translator.trans(s),className:"Webhook-error",type:"error",dismissible:!1}))},t}(O.a),A=function(e){function t(){return e.apply(this,arguments)||this}c(t,e);var o=t.prototype;return o.init=function(){e.prototype.init.call(this),this.values={},this.services=app.forum.attribute("reflar-webhooks.services").reduce(function(e,t){return e[t]=app.translator.trans("reflar-webhooks.admin.settings.services."+t),e},{}),this.webhooks=app.forum.webhooks(),this.settingsPrefix="reflar.webhooks",this.newWebhook={service:m.prop("discord"),url:m.prop(""),loading:m.prop(!1)}},o.view=function(){var e=this;return m("div",{className:"WebhooksPage"},m("div",{className:"container"},m("form",null,m("h2",null,app.translator.trans("reflar-webhooks.admin.settings.title")),m("p",{className:"helpText"},app.translator.trans("reflar-webhooks.admin.settings.help.general")),m("fieldset",null,m("div",{className:"Webhooks--Container"},this.webhooks.map(function(t){return z.component({webhook:t,services:e.services,onChange:e.updateWebhook.bind(e),onDelete:e.deleteWebhook.bind(e)})}),m("div",{className:"Webhooks--row"},m("div",{className:"Webhook-input"},x.a.component({options:this.services,value:this.newWebhook.service(),onchange:this.newWebhook.service}),m("input",{className:"FormControl Webhook-url",type:"url",placeholder:app.translator.trans("reflar-webhooks.admin.settings.help.url"),onchange:m.withAttr("value",this.newWebhook.url)}),w.a.component({type:"button",loading:this.newWebhook.loading(),className:"Button Button--warning Webhook-button",icon:"fas fa-plus",onclick:this.addWebhook.bind(this)}))))))))},o.addWebhook=function(){var e=this;return this.newWebhook.loading(!0),app.request({method:"POST",url:app.forum.attribute("apiUrl")+"/reflar/webhooks",data:{service:this.newWebhook.service(),url:this.newWebhook.url()}}).then(function(t){e.webhooks.push({id:m.prop(t.data.id),service:m.prop(t.data.attributes.service),url:m.prop(t.data.attributes.url),events:m.prop([])}),e.newWebhook.service("discord"),e.newWebhook.url(""),e.newWebhook.loading(!1),m.lazyRedraw()}).catch(function(){e.newWebhook.loading(!1),m.lazyRedraw()})},o.updateWebhook=function(e,t,o){var n;return this.webhooks.some(function(n){if(n.id()===e.id())return n[t]=m.prop(o),!0}),app.request({method:"PATCH",url:app.forum.attribute("apiUrl")+"/reflar/webhooks/"+e.id(),data:(n={},n[t]=o,n)})},o.deleteWebhook=function(e){return this.webhooks.splice(this.webhooks.indexOf(e),1),app.request({method:"DELETE",url:app.forum.attribute("apiUrl")+"/reflar/webhooks/"+e.id()})},o.changed=function(){var e=this;return this.fields.some(function(t){return e.values[t]()!==(app.data.settings[e.addPrefix(t)]||"")})},t}(y.a);r.a.initializers.add("reflar/webhooks",function(){r.a.store.models.webhooks=l,u.a.prototype.webhooks=s.a.hasMany("webhooks"),app.routes["reflar-webhooks"]={path:"/reflar/webhooks",component:A.component()},app.extensionSettings["reflar-webhooks"]=function(){return m.route(app.route("reflar-webhooks"))},Object(h.extend)(d.a.prototype,"items",function(e){e.add("reflar-webhooks",k.a.component({href:app.route("reflar-webhooks"),icon:"fas fa-external-link-alt",children:"Webhooks",description:app.translator.trans("reflar-webhooks.admin.nav.desc")}))})})}]);
//# sourceMappingURL=admin.js.map