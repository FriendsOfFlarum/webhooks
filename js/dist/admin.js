module.exports=function(e){var t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=17)}([function(e,t){e.exports=flarum.core.compat.Model},function(e,t){e.exports=flarum.core.compat["components/Button"]},function(e,t){e.exports=flarum.core.compat["components/Select"]},function(e,t){e.exports=flarum.core.compat.app},function(e,t){e.exports=flarum.core.compat["components/Alert"]},function(e,t){e.exports=flarum.core.compat["models/Forum"]},function(e,t){e.exports=flarum.core.compat["utils/mixin"]},function(e,t){e.exports=flarum.core.compat.extend},function(e,t){e.exports=flarum.core.compat["components/AdminNav"]},function(e,t){e.exports=flarum.core.compat["components/AdminLinkButton"]},function(e,t){e.exports=flarum.core.compat["components/Page"]},function(e,t){e.exports=flarum.core.compat.Component},function(e,t){e.exports=flarum.core.compat["components/Modal"]},function(e,t){e.exports=flarum.core.compat["components/Switch"]},function(e,t){e.exports=flarum.core.compat["components/Dropdown"]},function(e,t){e.exports=flarum.core.compat["helpers/icon"]},function(e,t){e.exports=flarum.core.compat["models/Group"]},function(e,t,o){"use strict";o.r(t);var n=o(3),r=o.n(n),a=o(0),s=o.n(a),i=o(5),u=o.n(i);function c(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var p,l=o(6),h=function(e){function t(){return e.apply(this,arguments)||this}return c(t,e),t.prototype.apiEndpoint=function(){return"/reflar/webhooks"+(this.exists?"/"+this.data.id:"")},t}(o.n(l)()(s.a,{id:s.a.attribute("id"),service:s.a.attribute("service"),url:s.a.attribute("url"),error:s.a.attribute("error"),events:s.a.attribute("events",(p=[],function(e){return e&&"string"==typeof e?JSON.parse(e):p})),groupId:s.a.attribute("group_id"),isValid:s.a.attribute("is_valid",Boolean)})),f=o(7),d=o(8),b=o.n(d),v=o(9),k=o.n(v),w=o(1),g=o.n(w),y=o(10),x=o.n(y),W=o(2),N=o.n(W),_=o(11),O=o.n(_),B=o(4),j=o.n(B),M=o(12),P=o.n(M),C=o(13),S=o.n(C),z=o(14),G=o.n(z),R=o(15),A=o.n(R),F=o(16),I=o.n(F),E=function(e){function t(){return e.apply(this,arguments)||this}c(t,e);var o=t.prototype;return o.init=function(){e.prototype.init.call(this),this.webhook=this.props.webhook;var t,o,n,r,a=app.data["reflar-webhooks.events"];this.loadingGroup=m.prop(!1),this.events=(t=a.reduce(function(e,t){var o=/((?:[a-z]+\\?)+?)\\Events?\\([a-z]+)/i.exec(t);if(!o)return e.other.push({full:t,name:t}),e.other=e.other.sort(),e;var n=o[1].toLowerCase().replace("\\",".");return e[n]||(e[n]=[]),e[n]=e[n].concat({full:t,name:o[2]}).sort(),e},{other:[]}),o=function(e){return e.split(".")[0]},n=Object.keys(t),r=Object.values(t),n.map("function"==typeof o?o:function(e){return e[o]}).reduce(function(e,t,o){return e[t]||(e[t]={}),e[t][n[o]]=r[o],e},{}))},o.className=function(){return"Modal--medium"},o.title=function(){return app.translator.trans("reflar-webhooks.admin.settings.modal.title")},o.content=function(){var e=this,t={2:"fas fa-globe",3:"fas fa-user"},o=app.store.getById("groups",this.webhook.groupId())||app.store.getById("groups",I.a.MEMBER_ID);return m("div",{className:"ReflarWebhooksModal Modal-body"},app.translator.trans("reflar-webhooks.admin.settings.modal.description"),m("div",{className:"Form"},m("div",{className:"Form-group"},G.a.component({label:[A()(this.loadingGroup()?"fas fa-spinner fa-spin":o.icon()||t[o.id()]),o.namePlural()],buttonClassName:"Button Button--danger",children:app.store.all("groups").filter(function(e){return["1","2"].includes(e.id())}).map(function(n){return g.a.component({active:o.id()===n.id(),disabled:o&&o.id()===n.id(),children:n.namePlural(),icon:n.icon()||t[n.id()],onclick:e.changeGroup.bind(e,n)})})})),m("div",{className:"Webhook-events"},Object.entries(this.events).map(function(t){t[0];var o,n=t[1];return m("div",null,Object.entries(n).sort((o=0,function(e,t){var n=e[o].toUpperCase(),r=t[o].toUpperCase();return n<r?-1:n>r?1:0})).map(function(t){var o=t[0],n=t[1];return n.length?m("div",null,m("h3",null,e.translate(o)),n.map(function(t){return S.a.component({state:e.webhook.events().includes(t.full),children:e.translate(o,t.name.toLowerCase()),onchange:e.onchange.bind(e,t.full)})})):null}))}))))},o.translate=function(e,t){return void 0===t&&(t="title"),app.translator.trans("reflar-webhooks.admin.settings.actions."+e+"."+t)},o.onchange=function(e,t,o){o.loading=!0;var n=this.webhook.events();return t?n.push(e):n.splice(n.indexOf(e),1),this.props.updateWebhook(n).then(function(){o.loading=!1,m.lazyRedraw()})},o.changeGroup=function(e){var t=this;return this.loadingGroup(!0),this.webhook.save({group_id:e.id()}).then(function(){t.loadingGroup(!1),m.lazyRedraw()})},t}(P.a),L=function(e){function t(){return e.apply(this,arguments)||this}c(t,e);var o=t.prototype;return o.init=function(){this.webhook=this.props.webhook,this.services=this.props.services,this.url=m.prop(this.webhook.url()),this.service=m.prop(this.webhook.service()),this.events=m.prop(this.webhook.events()),this.error=m.prop(this.webhook.error())},o.view=function(){var e=this,t=this.webhook,o=this.services,n=t.service(),r=[t.error&&t.error()];return o[n]?t.isValid()||r.push(app.translator.trans("reflar-webhooks.admin.errors.url_invalid")):r.push(app.translator.trans("reflar-webhooks.admin.errors.service_not_found",{service:n})),m("div",{className:"Webhooks--row"},m("div",{className:"Webhook-input"},N.a.component({options:o,value:n,onchange:this.update("service")}),m("input",{className:"FormControl Webhook-url",type:"url",value:this.url(),onchange:m.withAttr("value",this.update("url")),placeholder:app.translator.trans("reflar-webhooks.admin.settings.help.url")}),g.a.component({type:"button",className:"Button Webhook-button",icon:"fas fa-edit",onclick:function(){return app.modal.show(new E({webhook:t,updateWebhook:e.update("events")}))}}),g.a.component({type:"button",className:"Button Button--warning Webhook-button",icon:"fas fa-times",onclick:this.delete.bind(this)})),!this.events().length&&j.a.component({className:"Webhook-error",children:app.translator.trans("reflar-webhooks.admin.settings.help.disabled"),dismissible:!1}),r.filter(Boolean).map(function(e){return j.a.component({children:app.translator.trans(e),className:"Webhook-error",type:"error",dismissible:!1})}))},o.update=function(e){var t=this;return function(o){var n;return t[e](o),t.webhook.save((n={},n[e]=o,n)).then(function(){return m.lazyRedraw()})}},o.delete=function(){return this.webhook.delete().then(function(){return m.lazyRedraw()})},t}(O.a),T=function(e){function t(){return e.apply(this,arguments)||this}c(t,e);var o=t.prototype;return o.init=function(){e.prototype.init.call(this),this.values={},this.services=app.data["reflar-webhooks.services"].reduce(function(e,t){return e[t]=app.translator.trans("reflar-webhooks.admin.settings.services."+t),e},{}),this.newWebhook={service:m.prop("discord"),url:m.prop(""),loading:m.prop(!1)}},o.view=function(){var e=this,t=app.store.all("webhooks");return m("div",{className:"WebhooksPage"},m("div",{className:"container"},m("form",null,m("h1",null,app.translator.trans("reflar-webhooks.admin.settings.title")),m("p",{className:"helpText"},app.translator.trans("reflar-webhooks.admin.settings.help.general")),m("fieldset",null,m("div",{className:"Webhooks--Container"},t.map(function(t){return L.component({webhook:t,services:e.services})}),m("div",{className:"Webhooks--row"},m("div",{className:"Webhook-input"},N.a.component({options:this.services,value:this.newWebhook.service(),onchange:this.newWebhook.service}),m("input",{className:"FormControl Webhook-url",type:"url",placeholder:app.translator.trans("reflar-webhooks.admin.settings.help.url"),onchange:m.withAttr("value",this.newWebhook.url)}),g.a.component({type:"button",loading:this.newWebhook.loading(),className:"Button Button--warning Webhook-button",icon:"fas fa-plus",onclick:this.addWebhook.bind(this)}))))))))},o.addWebhook=function(){var e=this;return this.newWebhook.loading(!0),app.store.createRecord("webhooks").save({service:this.newWebhook.service(),url:this.newWebhook.url()}).then(function(){e.newWebhook.service("discord"),e.newWebhook.url(""),e.newWebhook.loading(!1),m.redraw()}).catch(function(){e.newWebhook.loading(!1),m.redraw()})},o.changed=function(){var e=this;return this.fields.some(function(t){return e.values[t]()!==(app.data.settings[e.addPrefix(t)]||"")})},t}(x.a);r.a.initializers.add("reflar/webhooks",function(){r.a.store.models.webhooks=h,u.a.prototype.webhooks=s.a.hasMany("webhooks"),app.routes["reflar-webhooks"]={path:"/reflar/webhooks",component:T.component()},app.extensionSettings["reflar-webhooks"]=function(){return m.route(app.route("reflar-webhooks"))},Object(f.extend)(b.a.prototype,"items",function(e){e.add("reflar-webhooks",k.a.component({href:app.route("reflar-webhooks"),icon:"fas fa-external-link-alt",children:"Webhooks",description:app.translator.trans("reflar-webhooks.admin.nav.desc")}))})})}]);
//# sourceMappingURL=admin.js.map